!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var s in r)("object"==typeof exports?exports:e)[s]=r[s]}}(this,(()=>(()=>{"use strict";var e={};(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);const t=new class{constructor(){this.eventsMatrix=[[]]}insertRecordScript(){return new Promise(((e,t)=>{const r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src","https://cdn.jsdelivr.net/npm/rrweb@latest/dist/record/rrweb-record.min.js"),document.head.insertBefore(r,document.head.lastChild),r.onload=()=>{e()},r.onerror=()=>{t("rrweb record onload err")}}))}insertVideoPlayerScript(){return new Promise(((e,t)=>{const r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src","https://cdn.jsdelivr.net/npm/rrweb-player@latest/dist/index.js"),document.head.insertBefore(r,document.head.lastChild),r.onload=()=>{e()},r.onerror=()=>{t("rrweb player onload err")}}))}insertVideoCss(){return new Promise(((e,t)=>{const r=document.createElement("link");r.setAttribute("rel","stylesheet"),r.setAttribute("href","https://cdn.jsdelivr.net/npm/rrweb-player@latest/dist/style.css"),document.head.insertBefore(r,document.head.lastChild),r.onload=()=>{e()},r.onerror=()=>{t("rrweb css onload err")}}))}async startRecording(){await this.insertRecordScript(),rrwebRecord&&rrwebRecord({emit:(e,t)=>{t&&this.eventsMatrix.push([]),this.eventsMatrix.length>20&&this.eventsMatrix.shift(),this.eventsMatrix[this.eventsMatrix.length-1].push(e)},checkoutEveryNms:2e4})}recordError(){const e=this.eventsMatrix.length;let t=this.eventsMatrix;return t=e>=2?this.eventsMatrix[e-2].concat(this.eventsMatrix[e-1]):this.eventsMatrix[0],t}async playVideo(e){await Promise.all([this.insertVideoPlayerScript(),this.insertVideoCss()]),new rrwebPlayer({target:document.body,props:{events:e}}).play()}};return"undefined"!=typeof window&&window&&(t.startRecording(),window.onload=()=>{!function(){var e=window.fetch;window.fetch=()=>e.apply(this,arguments).then((function(e){if(!e.ok)throw new Error(`Fetch err: ${e.url} ${e.status} (${e.statusText})`);return e})).catch((e=>{throw e}))}(),function(){let e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(...t){let r=this.send,s=this,n=[];return this.send=function(...e){return n=e,r.apply(s,e)},console.log("request"),this.addEventListener("readystatechange",(function(){if(4===this.readyState){!function(e){console.log(e,"---response");const t=e.config??{};if(200!==e?.config?.status)throw new Error(`Request Error: ${t.method} ${t.url} status:${t.status}`)}({config:{url:t[1],status:this.status,method:t[0],data:n},response:this.response})}}),!1),e.apply(this,t)}}()},window.addEventListener("unhandledrejection",(e=>{if((e.message||e.error?.message||e.reason?.message).includes("rrweb"))return;const r=t.recordError();t.playVideo(r)})),window.addEventListener("error",(e=>{if((e.message||e.error.message||e.reason.message).includes("rrweb"))return;const r=t.recordError();t.playVideo(r)}))),e})()));